!function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r,i,a){var o=arguments.length<=4||void 0===arguments[4]?null:arguments[4],u=arguments.length<=5||void 0===arguments[5]?null:arguments[5];n(this,e),this.content=t,this.contentPath=r,this.apiKey=i,this.apiHost=a,this.createdAt=o,this.updatedAt=u}return r(e,[{key:"isNew",value:function(){return!this.createdAt}}]),e}(),a=function(){function e(){n(this,e)}return r(e,[{key:"fetchContentBlocks",value:function(e,t,n){return jQuery.getJSON(t+"/v1/"+e+"/content_blocks?_="+this.cacheTime(n))}},{key:"storeContentBlock",value:function(e,t){return jQuery.ajax({url:e.apiHost+"/v1/"+e.apiKey+"/content_blocks",contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify({content_block:{content:e.content,content_path:e.contentPath},private_api_key:t}),headers:{"X-HTTP-Method-Override":"PUT"}})}},{key:"cacheTime",value:function(t){return t?Math.floor(this.currentTime()/e.MAX_CACHE_TTL)*e.MAX_CACHE_TTL:Math.round(this.currentTime())}},{key:"currentTime",value:function(){return Date.now()/1e3}}]),e}();a.MAX_CACHE_TTL=120;var o=function(){function e(){n(this,e)}return r(e,[{key:"convertJson",value:function(e,t){return new i(t.content,t.content_path,t.api_key,e.apiHost,t.created_at,t.updated_at)}},{key:"extractObjectFromHash",value:function(e,t){var n=t[e.contentPath];return n?this.convertJson(e,n):e}},{key:"convertJsonObjectToHash",value:function(e){var t={};return e.content_blocks.reduce(function(e,t){return e[t.content_path]=t,e},t)}}]),e}(),u=function(){function e(t){n(this,e),this.ajaxService=t,this.dataCache={},this.dataConverter=new o}return r(e,[{key:"loadContent",value:function(e,t){var n=this,r=this.cacheKey(e,t);return this.dataCache[r]||(this.dataCache[r]=this.loadAllContents(e,t)),this.dataCache[r].then(function(t){return n.dataConverter.extractObjectFromHash(e,t)})}},{key:"cacheKey",value:function(e,t){return[e.apiHost,e.apiKey,t].join("|")}},{key:"storeContent",value:function(e,t){return this.ajaxService.storeContentBlock(e,t)}},{key:"loadAllContents",value:function(e,t){var n=this;return this.ajaxService.fetchContentBlocks(e.apiKey,e.apiHost,t).then(function(e){return n.dataConverter.convertJsonObjectToHash(e)})}}]),e}(),c=function(){function e(){n(this,e)}return r(e,[{key:"loadEditor",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"//cdn.ckeditor.com/4.5.5/full/ckeditor.js":arguments[0];return jQuery.getScript(e)}}]),e}(),s=function(){function e(){n(this,e)}return r(e,[{key:"find",value:function(){return jQuery("[data-content-path]").toArray()}}]),e}(),l=function(){function e(t,r,i){n(this,e),this.element=t,this.contentBlock=r,this.privateApiKey=i}return r(e,[{key:"isEditable",value:function(){return null!==this.privateApiKey}}]),e}(),d=function(){function e(){n(this,e)}return r(e,[{key:"convert",value:function(e){var t=this.valueOf(e,"content-path"),n=this.valueOf(e,"api-key"),r=this.valueOf(e,"api-host"),a=this.extractPrivateApiKey(e);return new l(e,new i("",t,n,r),a)}},{key:"extractPrivateApiKey",value:function(e){var t=this.valueOf(e,"private-api-key");return""===t?null:t}},{key:"valueOf",value:function(e,t){var n=e.attributes.getNamedItem("data-"+t);return null===n?null:n.value}},{key:"createNewBlock",value:function(e,t){return new l(e.element,t,e.privateApiKey)}}]),e}(),h=function(){function e(){n(this,e)}return r(e,[{key:"draw",value:function(e){""===e.contentBlock.content&&e.contentBlock.isNew()||(e.element.innerHTML=e.contentBlock.content)}}]),e}(),f=function(){function e(t,r,i){n(this,e),this.dataService=t,this.loader=r,this.preparer=i,this.editorLoadingCallback=null}return r(e,[{key:"prepareEdit",value:function(e){var t=this;null===this.editorLoadingCallback&&(this.editorLoadingCallback=this.loader.loadEditor()),this.editorLoadingCallback.done(function(){return t.preparer.prepare(e,function(e,n){return t.editContent(e,n)})})}},{key:"editContent",value:function(e,t){var n=this,r=e.contentBlock,a=new i(t,r.contentPath,r.apiKey,r.apiHost);return this.dataService.storeContent(a,e.privateApiKey).then(function(){return n.preparer.notifySave(e,!0)}).fail(function(){return n.preparer.notifySave(e,!1)})}}]),e}(),v=function(){function e(t,r,i,a,o){n(this,e),this.finder=t,this.converter=r,this.dataService=i,this.drawer=a,this.editController=o}return r(e,[{key:"init",value:function(){var e=this,t=this.finder.find().map(function(t){return e.converter.convert(t)});t.forEach(function(t){return e.dataService.loadContent(t.contentBlock,!t.isEditable()).then(function(n){return e.handleElement(e.converter.createNewBlock(t,n))})})}},{key:"handleElement",value:function(e){this.drawer.draw(e),e.isEditable()&&this.editController.prepareEdit(e)}}]),e}(),p=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];n(this,e),this.ckeditor=t,jQuery('<style type="text/css">@keyframes renuo-cms-flash-success {0% { background: default; } 50% { background: #d7eed7; } 100% { background: default; }}@keyframes renuo-cms-flash-error {0% { background: default; } 50% { background: #f5d1d0; } 100% { background: default; }}.renuo-cms-edit-success{animation-name: renuo-cms-flash-success; animation-duration: 1.5s;}.renuo-cms-edit-error{animation-name: renuo-cms-flash-error; animation-duration: 1.5s;}</style>').appendTo("head")}return r(e,[{key:"prepare",value:function(e,t){null===this.ckeditor&&(this.ckeditor=CKEDITOR),"true"!==jQuery(e.element).attr("contenteditable")&&(jQuery(e.element).attr("contenteditable","true"),this.initCkeditor(e,t))}},{key:"notifySave",value:function(e,t){var n=t?"success":"error";jQuery(e.element).addClass("renuo-cms-edit-"+n).delay(2e3).queue(function(){return jQuery(e.element).removeClass("renuo-cms-edit-"+n).dequeue()})}},{key:"initCkeditor",value:function(e,t){var n=this;this.ckeditor.inline(e.element,this.ckeditorConfig()).on("blur",function(r){n.checkForUpdate(r,t,e)})}},{key:"checkForUpdate",value:function(e,t,n){if(e.editor.checkDirty()){var r=e.editor.getData();e.editor.resetDirty(),t(n,r)}}},{key:"ckeditorConfig",value:function(){return{toolbarGroups:[{name:"styles",groups:["styles"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi","paragraph"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]}],removePlugins:"bidi,font,forms,flash,horizontalrule,iframe",removeButtons:"Source,Save,NewPage,Preview,Templates,Print,SelectAll,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Outdent,Indent,Blockquote,CreateDiv,BidiLtr,BidiRtl,Language,Anchor,WidgetbootstrapAlert,WidgetbootstrapThreeCol,WidgetbootstrapTwoCol,WidgetbootstrapRightCol,WidgetbootstrapLeftCol,Flash,Image,Btgrid,Glyphicons,SpecialChar,Smiley,PageBreak,Iframe,Styles,Font,FontSize,TextColor,BGColor,Maximize,ShowBlocks,About",format_tags:"p;h1;h2;h3;h4;h5;h6;pre;address"}}}]),e}();!function(){var e=function(){var e=new u(new a),t=new v(new s,new d,e,new h,new f(e,new c,new p));t.init()};jQuery(e),jQuery(document).on("renuo-cms-reload",e)}(),t["true"]=e}({},function(){return this}());